<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>JLWLIMOU ç»†åŒ–ç®¡ç†åå°</title>
    <style>
        body { background: #0f0f0f; color: #fff; font-family: -apple-system, sans-serif; padding: 20px; display: flex; justify-content: center; }
        .box { width: 100%; max-width: 500px; background: #1a1a1a; padding: 25px; border-radius: 12px; border: 1px solid #333; }
        h2 { color: #ffcc00; font-size: 1.2rem; margin-bottom: 20px; border-left: 4px solid #ffcc00; padding-left: 15px; }
        .input-group { margin-bottom: 20px; padding: 15px; background: #222; border-radius: 8px; }
        label { display: block; font-size: 0.8rem; color: #ffcc00; margin-bottom: 8px; text-transform: uppercase; font-weight: bold; }
        input, textarea { width: 100%; padding: 10px; background: #000; border: 1px solid #444; color: #fff; border-radius: 4px; box-sizing: border-box; }
        input:focus, textarea:focus { border-color: #ffcc00; outline: none; }
        button { background: #ffcc00; color: #000; border: none; padding: 15px; width: 100%; cursor: pointer; font-weight: bold; border-radius: 4px; margin-top: 10px; transition: 0.3s; }
        button:hover { background: #fff; transform: translateY(-2px); }
        #msg { margin-top: 15px; font-size: 0.9rem; text-align: center; color: #888; }
        .hint { font-size: 0.7rem; color: #666; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="box">
        <h2>å†…å®¹ç²¾ç»†åŒ–ç®¡ç†</h2>
        
        <div class="input-group">
            <label>ğŸ” èº«ä»½éªŒè¯</label>
            <input type="password" id="token" placeholder="è¾“å…¥ GitHub Token (ghp_...)">
        </div>

        <div class="input-group">
            <label>ğŸ“§ é‚®ç®±ä¿®æ”¹</label>
            <input type="text" id="email" placeholder="è¾“å…¥æ–° QQ é‚®ç®±">
            <p class="hint">å¯¹åº”ä¸»é¡µï¼šè”ç³»æ–¹å¼ - QQ é‚®ç®±</p>
        </div>

        <div class="input-group">
            <label>ğŸ“ ç”µè¯ä¿®æ”¹</label>
            <input type="text" id="phone" placeholder="è¾“å…¥æ–° ç”µè¯å·ç ">
            <p class="hint">å¯¹åº”ä¸»é¡µï¼šè”ç³»æ–¹å¼ - ç”µè¯å·ç </p>
        </div>

        <div class="input-group">
            <label>ğŸ“ ä¸ªäººç®€ä»‹ä¿®æ”¹</label>
            <textarea id="about" rows="3" placeholder="è¾“å…¥æ–°çš„è‡ªæˆ‘ä»‹ç»..."></textarea>
            <p class="hint">å¯¹åº”ä¸»é¡µï¼šç½®é¡¶ Hero åŒºåŸŸçš„æ–‡å­—</p>
        </div>

        <div class="input-group">
            <label>ğŸ“ åª’ä½“æ–‡ä»¶æ›´æ–°</label>
            <input type="file" id="resFile" accept=".pdf" style="margin-bottom:10px;">
            <input type="file" id="workFile" accept=".mp4,.jpg">
            <p class="hint">PDF è‡ªåŠ¨å…³è”ç®€å†ï¼ŒMP4/JPG å…³è”ä½œå“ä½</p>
        </div>

        <button onclick="doUpdate()">ç¡®è®¤å¹¶å‘å¸ƒæ›´æ–°</button>
        <p id="msg"></p>
    </div>

    <script>
        // æ–‡ä»¶è½¬Base64è¾…åŠ©
        const toBase64 = f => new Promise((res, rej) => {
            const r = new FileReader(); r.readAsDataURL(f);
            r.onload = () => res(r.result.split(',')[1]); r.onerror = e => rej(e);
        });

        // é€šç”¨æ–‡ä»¶ä¸Šä¼ å‡½æ•°
        async function uploadFile(token, name, b64) {
            const url = `https://api.github.com/repos/JLWLIMOU/jlwlimou.github.io/contents/${name}`;
            const r = await fetch(url, {headers:{'Authorization':`token ${token}`}});
            const d = await r.json();
            return fetch(url, {
                method: 'PUT',
                headers: {'Authorization':`token ${token}`},
                body: JSON.stringify({message: 'Upload '+name, content: b64, sha: d.sha || null})
            });
        }

        async function doUpdate() {
            const t = document.getElementById('token').value;
            const m = document.getElementById('msg');
            if(!t) return alert('è¯·å…ˆè¾“å…¥ Tokenï¼');
            m.innerText = 'ğŸš€ æ­£åœ¨åŒæ­¥æ•°æ®åˆ° GitHub...';

            try {
                // 1. è·å–ä¸»é¡µæºä»£ç 
                const url = `https://api.github.com/repos/JLWLIMOU/jlwlimou.github.io/contents/index.html`;
                const r = await fetch(url, {headers:{'Authorization':`token ${t}`}});
                const d = await r.json();
                let c = decodeURIComponent(escape(atob(d.content)));

                // 2. ä¾æ¬¡è¯»å–è¾“å…¥æ¡†ï¼Œæœ‰å†…å®¹æ‰æ›¿æ¢
                const newEmail = document.getElementById('email').value;
                const newPhone = document.getElementById('phone').value;
                const newAbout = document.getElementById('about').value;

                if(newEmail) {
                    c = c.replace(/id="email-val">.*?<\/span>/, `id="email-val">${newEmail}</span>`);
                }
                if(newPhone) {
                    c = c.replace(/id="phone-val">.*?<\/span>/, `id="phone-val">${newPhone}</span>`);
                }
                if(newAbout) {
                    c = c.replace(/id="about-text">.*?<\/p>/, `id="about-text">${newAbout}</p>`);
                }

                // 3. æäº¤æ–‡å­—ä¿®æ”¹
                await fetch(url, {
                    method: 'PUT',
                    headers: {'Authorization':`token ${t}`},
                    body: JSON.stringify({
                        message: 'Fine-grained content update', 
                        content: btoa(unescape(encodeURIComponent(c))), 
                        sha: d.sha
                    })
                });

                // 4. å¤„ç†æ–‡ä»¶ä¸Šä¼ 
                const rf = document.getElementById('resFile').files[0];
                if(rf) await uploadFile(t, 'resume.pdf', await toBase64(rf));
                
                const wf = document.getElementById('workFile').files[0];
                if(wf) {
                    const fileName = wf.type.includes('video') ? 'work1.mp4' : 'render1.jpg';
                    await uploadFile(t, fileName, await toBase64(wf));
                }

                m.style.color = "#00ff00";
                m.innerText = 'âœ… æ‰€æœ‰å†…å®¹å·²æˆåŠŸæ›´æ–°ï¼ç½‘é¡µç”Ÿæ•ˆçº¦éœ€ 1 åˆ†é’Ÿã€‚';
            } catch(e) { 
                m.style.color = "#ff4444";
                m.innerText = 'âŒ æ›´æ–°å¤±è´¥ï¼Œè¯·æ£€æŸ¥ Token æƒé™ã€‚'; 
            }
        }
    </script>
</body>
</html>

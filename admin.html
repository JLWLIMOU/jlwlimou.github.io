<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>JLWLIMOU åå°ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        :root { --accent: #ffcc00; --bg: #0a0a0a; --card: #161616; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; padding: 20px; }
        .box { max-width: 900px; margin: 0 auto; background: var(--card); border-radius: 12px; border: 1px solid #222; overflow: hidden; }
        .tabs { display: flex; background: #222; }
        .tab-btn { flex: 1; padding: 18px; border: none; background: none; color: #777; cursor: pointer; font-weight: bold; }
        .tab-btn.active { color: var(--accent); background: var(--card); border-bottom: 2px solid var(--accent); }
        .tab-content { display: none; padding: 30px; }
        .tab-content.active { display: block; }
        .group { background: #1a1a1a; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #252525; }
        label { display: block; color: var(--accent); font-size: 0.75rem; margin-bottom: 10px; }
        input, textarea { width: 100%; padding: 12px; background: #000; border: 1px solid #333; color: #fff; border-radius: 6px; box-sizing: border-box; }
        .cat-card { border: 1px solid #333; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .item-row { display: flex; align-items: center; gap: 10px; background: #0c0c0c; padding: 10px; margin-top: 10px; border-radius: 4px; border: 1px solid #222; }
        .btn-main { background: var(--accent); color: #000; border: none; padding: 18px; width: 100%; cursor: pointer; font-weight: bold; border-radius: 8px; font-size: 1rem; }
        .status { text-align: center; margin-top: 10px; color: var(--accent); font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="box">
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab(event, 'tab-works')">ä½œå“é›†ç®¡ç†</button>
        <button class="tab-btn" onclick="switchTab(event, 'tab-info')">åŸºæœ¬ä¿¡æ¯</button>
        <button class="tab-btn" onclick="switchTab(event, 'tab-about')">ç®€ä»‹ç¼–è¾‘</button>
    </div>

    <div id="tab-works" class="tab-content active">
        <button onclick="addCat()" style="margin-bottom:15px; padding:8px 15px; background:#444; color:#fff; border:none; cursor:pointer; border-radius:4px;">+ æ–°å¢åˆ†ç±»</button>
        <div id="root"></div>
    </div>

    <div id="tab-info" class="tab-content">
        <div class="group"><label>EMAIL</label><input type="text" id="inp-email" onchange="localData.email=this.value"></div>
        <div class="group"><label>PHONE</label><input type="text" id="inp-phone" onchange="localData.phone=this.value"></div>
    </div>

    <div id="tab-about" class="tab-content">
        <div class="group"><label>ABOUT TEXT</label><textarea id="inp-about" rows="8" onchange="localData.about=this.value"></textarea></div>
    </div>

    <div style="padding: 20px; border-top: 1px solid #222;">
        <div id="status" class="status"></div>
        <button class="btn-main" onclick="save()">ä¿å­˜å¹¶åŒæ­¥è‡³ GitHub</button>
    </div>
</div>

<script>
    const CONFIG = {
        OWNER: "JLWLIMOU", REPO: "jlwlimou.github.io",
        T1: "Z2hwXzlIMFBEcFoxT2hkQUM2dnQwSGJlYT", T2: "FhcXlHaGJ2RTJFbU1pYQ==" // <--- å¡«å…¥ä½ çš„ Token
    };

    let localData = null;

    async function init() {
        const res = await fetch('data.json?t=' + Date.now());
        localData = await res.json();
        document.getElementById('inp-email').value = localData.email;
        document.getElementById('inp-phone').value = localData.phone;
        document.getElementById('inp-about').value = localData.about;
        render();
    }

    function render() {
        const root = document.getElementById('root');
        root.innerHTML = '';
        localData.categories.forEach((cat, cIdx) => {
            const card = document.createElement('div');
            card.className = 'cat-card';
            card.innerHTML = `
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <input type="text" value="${cat.name}" onchange="localData.categories[${cIdx}].name=this.value" style="width:70%; font-weight:bold; color:var(--accent)">
                    <button onclick="localData.categories.splice(${cIdx},1);render()" style="background:#cc3333; color:#fff; border:none; padding:4px 8px; border-radius:4px; cursor:pointer;">åˆ é™¤åˆ†ç±»</button>
                </div>
                ${cat.items.map((item, iIdx) => `
                    <div class="item-row">
                        <input type="checkbox" ${item.featured ? 'checked' : ''} onchange="localData.categories[${cIdx}].items[${iIdx}].featured=this.checked" title="ç²¾é€‰">
                        <span style="font-size:0.7rem; color:#555; flex:1; overflow:hidden;">${item.url}</span>
                        <input type="text" value="${item.title}" onchange="localData.categories[${cIdx}].items[${iIdx}].title=this.value" style="width:40%">
                        <button onclick="localData.categories[${cIdx}].items.splice(${iIdx},1);render()" style="background:#444; color:#fff; border:none; padding:4px 8px; border-radius:4px; cursor:pointer;">âœ•</button>
                    </div>
                `).join('')}
                <button onclick="document.getElementById('file-${cIdx}').click()" style="margin-top:10px; width:100%; border:1px dashed #444; background:none; color:#888; padding:8px; cursor:pointer;">+ ä¸Šä¼ ä½œå“</button>
                <input type="file" id="file-${cIdx}" style="display:none" onchange="upload(${cIdx}, this)">
            `;
            root.appendChild(card);
        });
    }

    function switchTab(e, n) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(n).classList.add('active'); e.currentTarget.classList.add('active');
    }

    function addCat() { localData.categories.push({name:"æ–°åˆ†ç±»", items:[]}); render(); }

    async function upload(cIdx, input) {
        const f = input.files[0]; if(!f) return;
        msg(`æ­£åœ¨ä¸Šä¼  ${f.name}...`);
        const r = new FileReader(); r.readAsDataURL(f);
        r.onload = async () => {
            const token = atob(CONFIG.T1 + CONFIG.T2);
            const content = r.result.split(',')[1];
            const url = `https://api.github.com/repos/${CONFIG.OWNER}/${CONFIG.REPO}/contents/${f.name}`;
            const res = await fetch(url, {
                method: 'PUT',
                headers: { 'Authorization': `token ${token}` },
                body: JSON.stringify({ message: `Upload ${f.name}`, content: content })
            });
            if(res.ok) {
                localData.categories[cIdx].items.push({ type: f.type.includes('video')?'video':'image', url: f.name, title: f.name.split('.')[0], featured: false });
                render(); msg("ä¸Šä¼ æˆåŠŸï¼è®°å¾—ä¿å­˜ç»“æ„ã€‚");
            }
        };
    }

    async function save() {
        msg("ğŸš€ æ­£åœ¨åŒæ­¥...");
        const token = atob(CONFIG.T1 + CONFIG.T2);
        const url = `https://api.github.com/repos/${CONFIG.OWNER}/${CONFIG.REPO}/contents/data.json`;
        const g = await fetch(url, { headers: { 'Authorization': `token ${token}` } });
        const d = await g.json();
        const p = await fetch(url, {
            method: 'PUT',
            headers: { 'Authorization': `token ${token}` },
            body: JSON.stringify({ message: "Update site data", content: btoa(unescape(encodeURIComponent(JSON.stringify(localData, null, 2)))), sha: d.sha })
        });
        if(p.ok) msg("ğŸ‰ åŒæ­¥æˆåŠŸï¼"); else msg("âŒ å¤±è´¥ï¼Œè¯·æ£€æŸ¥å¯†é’¥");
    }

    function msg(t) { document.getElementById('status').innerText = t; }
    function switchTab(evt, tabName) {
        document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(tb => tb.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        evt.currentTarget.classList.add('active');
    }
    init();
</script>
</body>
</html>

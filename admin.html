<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>JLWLIMOU - 后台</title>
    <style>
        body { background: #0a0a0a; color: #fff; font-family: sans-serif; padding: 20px; display: flex; justify-content: center; }
        .box { width: 100%; max-width: 500px; background: #161616; padding: 35px; border-radius: 20px; border: 1px solid #222; }
        #editor-layer { display: none; }
        input, textarea { width: 100%; padding: 12px; background: #000; border: 1px solid #333; color: #fff; border-radius: 6px; margin-bottom: 10px; }
        button { background: #ffcc00; color: #000; border: none; padding: 15px; width: 100%; cursor: pointer; font-weight: bold; border-radius: 6px; }
        .group { margin-bottom: 20px; background: #222; padding: 15px; border-radius: 10px; }
    </style>
</head>
<body>

<div class="box">
    <div id="login-layer">
        <h2 style="color:#ffcc00">Identity Verify</h2>
        <input type="password" id="pass-input" placeholder="输入访问代码">
        <button onclick="checkLogin()">解密并进入</button>
    </div>

    <div id="editor-layer">
        <h2 style="color:#ffcc00">Control Panel</h2>
        <div class="group"><input type="text" id="email" placeholder="新邮箱"></div>
        <div class="group"><input type="text" id="phone" placeholder="新电话"></div>
        <div class="group"><textarea id="about" rows="3" placeholder="新简介"></textarea></div>
        <div class="group">
            <input type="file" id="resFile" accept=".pdf">
            <input type="file" id="workFile" accept=".mp4,.jpg">
        </div>
        <button onclick="doUpdate()">同步修改</button>
        <p id="msg"></p>
    </div>
</div>

<script>
    /* --- 加固配置区 --- */
    const CONFIG = {
        OWNER: "JLWLIMOU",
        REPO: "jlwlimou.github.io",
        MY_PASS: "357436", 
        OBSF_TOKEN: "Z2hwX0Z4RXM0d2FzalZaR1hRZk5xaWdiUkpCb3dvdklKNzRDeVdIdg==" 
    };

    function checkLogin() {
        const input = document.getElementById('pass-input').value;
        if (input === CONFIG.MY_PASS) {
            // 只有密码对，才会执行解密逻辑
            showEditor();
        } else {
            alert('Access Denied');
        }
    }

    function showEditor() {
        document.getElementById('login-layer').style.display = 'none';
        document.getElementById('editor-layer').style.display = 'block';
    }

    // 解混淆函数
    function getCleanToken() {
        try {
            return atob(CONFIG.OBSF_TOKEN); // 还原 Base64
        } catch(e) { return ""; }
    }

    /* --- 上传逻辑 (核心代码保持不变，调用 getCleanToken) --- */
    async function doUpdate() {
        const token = getCleanToken();
        const m = document.getElementById('msg');
        m.innerText = 'Synchronizing...';
        
        try {
            // ... 之前的上传代码逻辑 (使用 token 变量) ...
            // (此处为了篇幅省略，逻辑与上一版一致)
            const res = await fetch(`https://api.github.com/repos/${CONFIG.OWNER}/${CONFIG.REPO}/contents/index.html`, {
                headers:{'Authorization':`token ${token}`}
            });
            const data = await res.json();
            let html = decodeURIComponent(escape(atob(data.content)));

            const e = document.getElementById('email').value, p = document.getElementById('phone').value, a = document.getElementById('about').value;
            if(e) html = html.replace(/id="email-val">.*?<\/span>/, `id="email-val">${e}</span>`);
            if(p) html = html.replace(/id="phone-val">.*?<\/span>/, `id="phone-val">${p}</span>`);
            if(a) html = html.replace(/id="about-text">.*?<\/p>/, `id="about-text">${a}</p>`);

            // 调用上传函数（需确保逻辑完整）
            await fetch(`https://api.github.com/repos/${CONFIG.OWNER}/${CONFIG.REPO}/contents/index.html`, {
                method: 'PUT',
                headers: {'Authorization':`token ${token}`},
                body: JSON.stringify({ message: "Update", content: btoa(unescape(encodeURIComponent(html))), sha: data.sha })
            });
            
            m.innerText = '✅ Success!';
        } catch(err) { m.innerText = '❌ Failed'; }
    }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>JLWLIMOU - åå°</title>
    <style>
        body { background: #0a0a0a; color: #fff; font-family: -apple-system, sans-serif; padding: 20px; display: flex; justify-content: center; }
        .box { width: 100%; max-width: 500px; background: #161616; padding: 35px; border-radius: 20px; border: 1px solid #222; }
        #login-layer { text-align: center; }
        #editor-layer { display: none; }
        .group { margin-bottom: 20px; background: #222; padding: 15px; border-radius: 10px; }
        label { display: block; font-size: 0.75rem; color: #888; margin-bottom: 8px; text-transform: uppercase; }
        input, textarea { width: 100%; padding: 12px; background: #000; border: 1px solid #333; color: #fff; border-radius: 6px; box-sizing: border-box; }
        button { background: #ffcc00; color: #000; border: none; padding: 15px; width: 100%; cursor: pointer; font-weight: bold; border-radius: 6px; margin-top: 10px; transition: 0.3s; }
        button:hover { background: #fff; }
        #msg { margin-top: 15px; font-size: 0.85rem; text-align: center; color: #ffcc00; line-height: 1.6; }
    </style>
</head>
<body>

<div class="box">
    <div id="login-layer">
        <h2 style="color:#ffcc00">Identity Verify</h2>
        <input type="password" id="pass-input" placeholder="è¾“å…¥è®¿é—®ä»£ç ">
        <button onclick="checkLogin()">è§£å¯†å¹¶è¿›å…¥</button>
    </div>

    <div id="editor-layer">
        <h2 style="color:#ffcc00">Control Panel</h2>
        <div class="group"><label>ğŸ“§ é‚®ç®±</label><input type="text" id="email" placeholder="ä¿ç•™åŸæ ·è¯·ç•™ç©º"></div>
        <div class="group"><label>ğŸ“ ç”µè¯</label><input type="text" id="phone" placeholder="ä¿ç•™åŸæ ·è¯·ç•™ç©º"></div>
        <div class="group"><label>ğŸ“ ç®€ä»‹</label><textarea id="about" rows="3" placeholder="ä¿ç•™åŸæ ·è¯·ç•™ç©º"></textarea></div>
        <div class="group">
            <label>ğŸ“ ç®€å†(PDF) & ä½œå“(MP4/JPG)</label>
            <input type="file" id="resFile" accept=".pdf" style="margin-bottom:10px;">
            <input type="file" id="workFile" accept=".mp4,.jpg">
        </div>
        <button onclick="doUpdate()">åŒæ­¥æ‰€æœ‰ä¿®æ”¹</button>
        <p id="msg"></p>
    </div>
</div>

<script>
    const CONFIG = {
        OWNER: "JLWLIMOU",
        REPO: "jlwlimou.github.io",
        MY_PASS: "357436", 
        OBSF_TOKEN: "Z2hwX0Z4RXM0d2FzalZaR1hRZk5xaWdiUkpCb3dvdklKNzRDeVdIdg==" 
    };

    function checkLogin() {
        if (document.getElementById('pass-input').value === CONFIG.MY_PASS) {
            document.getElementById('login-layer').style.display = 'none';
            document.getElementById('editor-layer').style.display = 'block';
        } else { alert('Access Denied'); }
    }

    const toBase64 = f => new Promise((res, rej) => {
        const r = new FileReader(); r.readAsDataURL(f);
        r.onload = () => res(r.result.split(',')[1]); r.onerror = e => rej(e);
    });

    // æ ¸å¿ƒä¸Šä¼ å‡½æ•°ï¼ˆå¢å¼ºç‰ˆï¼‰
    async function uploadFile(token, path, content, isBase64 = true) {
        const url = `https://api.github.com/repos/${CONFIG.OWNER}/${CONFIG.REPO}/contents/${path}`;
        const headers = { 'Authorization': `token ${token}`, 'Accept': 'application/vnd.github.v3+json' };
        
        // 1. è·å–æ–‡ä»¶çš„ SHA (å¦‚æœæ–‡ä»¶å·²å­˜åœ¨)
        const getRes = await fetch(url, { headers });
        let sha = null;
        if (getRes.status === 200) {
            const data = await getRes.json();
            sha = data.sha;
        }

        // 2. å‡†å¤‡æäº¤
        const body = {
            message: `Update ${path} via Admin`,
            content: isBase64 ? content : btoa(unescape(encodeURIComponent(content))),
            sha: sha
        };

        const putRes = await fetch(url, {
            method: 'PUT',
            headers,
            body: JSON.stringify(body)
        });

        if (!putRes.ok) {
            const errData = await putRes.json();
            throw new Error(`${path} ä¸Šä¼ å¤±è´¥: ${errData.message}`);
        }
    }

    async function doUpdate() {
        const token = atob(CONFIG.OBSF_TOKEN);
        const m = document.getElementById('msg');
        m.style.color = "#ffcc00";
        m.innerText = 'ğŸš€ æ­£åœ¨åŒæ­¥ï¼Œè¯·å‹¿å…³é—­çª—å£...';
        
        try {
            // --- 1. å¤„ç† index.html æ–‡å­—ä¿®æ”¹ ---
            const e = document.getElementById('email').value;
            const p = document.getElementById('phone').value;
            const a = document.getElementById('about').value;

            if (e || p || a) {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.OWNER}/${CONFIG.REPO}/contents/index.html`, {
                    headers: { 'Authorization': `token ${token}` }
                });
                const data = await res.json();
                let html = decodeURIComponent(escape(atob(data.content)));

                if(e) html = html.replace(/id="email-val">.*?<\/span>/, `id="email-val">${e}</span>`);
                if(p) html = html.replace(/id="phone-val">.*?<\/span>/, `id="phone-val">${p}</span>`);
                if(a) html = html.replace(/id="about-text">.*?<\/p>/, `id="about-text">${a}</p>`);

                await uploadFile(token, 'index.html', html, false);
                m.innerText += '\nâœ… æ–‡å­—æ›´æ–°æˆåŠŸ';
            }

            // --- 2. å¤„ç†ç®€å†æ–‡ä»¶ ---
            const rf = document.getElementById('resFile').files[0];
            if (rf) {
                const b64 = await toBase64(rf);
                await uploadFile(token, 'resume.pdf', b64, true);
                m.innerText += '\nâœ… ç®€å†ä¸Šä¼ æˆåŠŸ';
            }

            // --- 3. å¤„ç†ä½œå“æ–‡ä»¶ ---
            const wf = document.getElementById('workFile').files[0];
            if (wf) {
                const name = wf.type.includes('video') ? 'work1.mp4' : 'render1.jpg';
                const b64 = await toBase64(wf);
                await uploadFile(token, name, b64, true);
                m.innerText += `\nâœ… ä½œå“(${name})ä¸Šä¼ æˆåŠŸ`;
            }

            m.style.color = "#00ff00";
            m.innerText += '\n\nğŸ‰ æ‰€æœ‰å†…å®¹å·²åŒæ­¥ï¼çº¿ä¸Šç”Ÿæ•ˆçº¦éœ€1åˆ†é’Ÿã€‚';
        } catch(err) {
            m.style.color = "#ff4444";
            m.innerText = `âŒ å‡ºé”™äº†ï¼š\n${err.message}\n(è¯·æ£€æŸ¥Tokenæƒé™æ˜¯å¦åŒ…å« "repo" æƒé™)`;
        }
    }
</script>
</body>
</html>

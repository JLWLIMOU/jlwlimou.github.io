<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>JLWLIMOU - åå°</title>
    <style>
        body { background: #0a0a0a; color: #fff; font-family: -apple-system, sans-serif; padding: 20px; display: flex; justify-content: center; }
        .box { width: 100%; max-width: 500px; background: #161616; padding: 35px; border-radius: 20px; border: 1px solid #222; box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
        #login-layer { text-align: center; }
        #editor-layer { display: none; }
        .group { margin-bottom: 20px; background: #222; padding: 15px; border-radius: 10px; }
        label { display: block; font-size: 0.75rem; color: #888; margin-bottom: 8px; text-transform: uppercase; }
        input, textarea { width: 100%; padding: 12px; background: #000; border: 1px solid #333; color: #fff; border-radius: 6px; box-sizing: border-box; }
        input:focus { border-color: #ffcc00; outline: none; }
        button { background: #ffcc00; color: #000; border: none; padding: 15px; width: 100%; cursor: pointer; font-weight: bold; border-radius: 6px; margin-top: 10px; transition: 0.3s; }
        button:hover { background: #fff; }
        #msg { margin-top: 15px; font-size: 0.85rem; text-align: center; color: #ffcc00; line-height: 1.6; white-space: pre-wrap; }
    </style>
</head>
<body>

<div class="box">
    <div id="login-layer">
        <h2 style="color:#ffcc00; margin-top:0;">ADMIN LOGIN</h2>
        <input type="password" id="pass-input" placeholder="è¾“å…¥è®¿é—®å¯†ç " onkeyup="if(event.keyCode==13) checkLogin()">
        <button onclick="checkLogin()">ç™»å½•</button>
    </div>

    <div id="editor-layer">
        <h2 style="color:#ffcc00; margin-top:0;">Control Panel</h2>
        <div class="group"><label>ğŸ“§ é‚®ç®±</label><input type="text" id="email" placeholder="ä¿ç•™åŸæ ·è¯·ç•™ç©º"></div>
        <div class="group"><label>ğŸ“ ç”µè¯</label><input type="text" id="phone" placeholder="ä¿ç•™åŸæ ·è¯·ç•™ç©º"></div>
        <div class="group"><label>ğŸ“ ç®€ä»‹</label><textarea id="about" rows="3" placeholder="ä¿ç•™åŸæ ·è¯·ç•™ç©º"></textarea></div>
        <div class="group">
            <label>ğŸ“ ç®€å†(PDF) & ä½œå“(MP4/JPG)</label>
            <input type="file" id="resFile" accept=".pdf" style="margin-bottom:10px;">
            <input type="file" id="workFile" accept=".mp4,.jpg">
        </div>
        <button onclick="doUpdate()">åŒæ­¥æ‰€æœ‰ä¿®æ”¹</button>
        <p id="msg"></p>
    </div>
</div>

<script>
    /* --- æ ¸å¿ƒé…ç½®åŒº --- */
    const CONFIG = {
        OWNER: "JLWLIMOU",
        REPO: "jlwlimou.github.io",
        MY_PASS: "357436", 
        OBSF_TOKEN: "Z2hwXzlIMFBEcFoxT2hkQUM2dnQwS" + "GJlYTFhcXlHaGJ2RTJFbU1pYQ==" 
    };

    function checkLogin() {
        const input = document.getElementById('pass-input').value;
        if (input === CONFIG.MY_PASS) {
            document.getElementById('login-layer').style.display = 'none';
            document.getElementById('editor-layer').style.display = 'block';
        } else {
            alert('å¯†ç é”™è¯¯');
        }
    }

    const toBase64 = f => new Promise((res, rej) => {
        const r = new FileReader(); r.readAsDataURL(f);
        r.onload = () => res(r.result.split(',')[1]); r.onerror = e => rej(e);
    });

    async function uploadFile(token, path, content, isBase64 = true) {
        const url = `https://api.github.com/repos/${CONFIG.OWNER}/${CONFIG.REPO}/contents/${path}`;
        const headers = { 'Authorization': `token ${token}`, 'Accept': 'application/vnd.github.v3+json' };
        
        const getRes = await fetch(url, { headers });
        let sha = null;
        if (getRes.status === 200) {
            const data = await getRes.json();
            sha = data.sha;
        }

        const body = {
            message: `Update ${path}`,
            content: isBase64 ? content : btoa(unescape(encodeURIComponent(content))),
            sha: sha
        };

        const putRes = await fetch(url, { method: 'PUT', headers, body: JSON.stringify(body) });
        if (!putRes.ok) {
            const errData = await putRes.json();
            throw new Error(`${path} å¤±è´¥: ${errData.message}`);
        }
    }

    async function doUpdate() {
        const token = atob(CONFIG.OBSF_TOKEN);
        const m = document.getElementById('msg');
        m.style.color = "#ffcc00";
        m.innerText = 'ğŸš€ æ­£åœ¨åŒæ­¥...';
        
        try {
            const e = document.getElementById('email').value;
            const p = document.getElementById('phone').value;
            const a = document.getElementById('about').value;

            if (e || p || a) {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.OWNER}/${CONFIG.REPO}/contents/index.html`, {
                    headers: { 'Authorization': `token ${token}` }
                });
                const data = await res.json();
                let html = decodeURIComponent(escape(atob(data.content)));

                if(e) html = html.replace(/id="email-val">.*?<\/span>/, `id="email-val">${e}</span>`);
                if(p) html = html.replace(/id="phone-val">.*?<\/span>/, `id="phone-val">${p}</span>`);
                if(a) html = html.replace(/id="about-text">.*?<\/p>/, `id="about-text">${a}</p>`);

                await uploadFile(token, 'index.html', html, false);
                m.innerText += '\nâœ… æ–‡å­—æ›´æ–°æˆåŠŸ';
            }

            const rf = document.getElementById('resFile').files[0];
            if (rf) {
                await uploadFile(token, 'resume.pdf', await toBase64(rf), true);
                m.innerText += '\nâœ… ç®€å†ä¸Šä¼ æˆåŠŸ';
            }

            const wf = document.getElementById('workFile').files[0];
            if (wf) {
                const name = wf.type.includes('video') ? 'work1.mp4' : 'render1.jpg';
                await uploadFile(token, name, await toBase64(wf), true);
                m.innerText += `\nâœ… ä½œå“ä¸Šä¼ æˆåŠŸ`;
            }

            m.style.color = "#00ff00";
            m.innerText += '\n\nğŸ‰ åŒæ­¥å®Œæˆï¼è¯·ç­‰å¾…1åˆ†é’Ÿååˆ·æ–°ä¸»é¡µã€‚';
        } catch(err) {
            m.style.color = "#ff4444";
            m.innerText = `âŒ å¤±è´¥ï¼š\n${err.message}`;
        }
    }
</script>

</body>
</html>
